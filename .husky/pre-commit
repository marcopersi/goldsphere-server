#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Run lint
echo "ğŸ“ Linting code..."
bun run lint
if [ $? -ne 0 ]; then
  echo "âŒ Linting failed. Please fix the errors and try again."
  exit 1
fi

# Run jscpd copy-paste detection
echo "ğŸ” Running jscpd copy-paste detection..."
jscpd --config .jscpd.json
if [ $? -ne 0 ]; then
  echo "âŒ jscpd found too much code duplication. Please reduce duplication and try again."
  echo "ğŸ’¡ Run 'node scripts/jscpd-html-report.mjs' to see detailed report."
  exit 1
fi

# Run build
echo "ğŸ”¨ Building project..."
bun run build
if [ $? -ne 0 ]; then
  echo "âŒ Build failed. Please fix the errors and try again."
  exit 1
fi

# Run tests
echo "ğŸ§ª Running tests..."
bun run test
if [ $? -ne 0 ]; then
  echo "âŒ Tests failed. Please fix the failing tests and try again."
  exit 1
fi

echo "âœ… All pre-commit checks passed!"
